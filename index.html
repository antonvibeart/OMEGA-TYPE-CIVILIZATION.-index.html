<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manifesto of an Omega-Type Civilization</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0b0f19;
            color: #e2e8f0;
        }
        .container {
            max-width: 960px;
        }
        .section-title {
            position: relative;
            font-size: 2.5rem;
            font-weight: 700;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            color: #ffffff;
        }
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 4px;
            background-color: #6366f1;
            border-radius: 9999px;
        }
        .card {
            background-color: #1e293b;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.2);
        }
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header Section -->
    <header class="py-12 bg-gray-900 shadow-lg">
        <div class="container mx-auto px-6 text-center">
            <h1 class="text-4xl md:text-6xl font-bold tracking-tight text-white leading-tight">MANIFESTO OF AN OMEGA-TYPE CIVILIZATION</h1>
            <p class="mt-4 text-lg text-gray-400 font-light">(Philosophy, science, and strategy for infinite development)</p>
        </div>
    </header>

    <!-- Main Content Sections -->
    <main class="py-16">
        <div class="container mx-auto px-6 space-y-16">

            <!-- I. Essence and Definition -->
            <section id="section-1" class="card rounded-2xl p-8">
                <h2 class="section-title flex items-center justify-between">
                    <span>I. Essence and Definition</span>
                    <button onclick="synthesizeSpeech('I. Essence and Definition. ' + document.querySelector('#section-1 p').innerText)" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200">
                        ✨ Listen
                    </button>
                </h2>
                <p class="text-gray-300 leading-relaxed">
                    An Omega-type civilization is a form of intelligence that has reached a level of development where it: Has overcome the limitations of its original biological and material nature. Has mastered complete control over energy and information in its cosmos. Is capable of creating, modifying, or nullifying the laws of physics on local or global scales. Operates within the context of metareality, levels of existence that are beyond our Universe. The difference from the traditional concept of God: An Omega can be the result of evolution, not an eternal and immutable being. It can be subject to higher-level "metalaws." There can be a multitude of Omega civilizations.
                </p>
            </section>

            <!-- II. Signs to look for -->
            <section id="section-2" class="card rounded-2xl p-8">
                <h2 class="section-title flex items-center justify-between">
                    <span>II. Signs to look for</span>
                    <button onclick="synthesizeSpeech('II. Signs to look for. ' + document.querySelector('#section-2 ol').innerText)" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200">
                        ✨ Listen
                    </button>
                </h2>
                <ol class="list-decimal list-inside space-y-2 text-gray-300">
                    <li>Anomalous fine-tuning of physical constants.</li>
                    <li>Non-local correlations in the structure of the Universe.</li>
                    <li>Unnatural distributions of matter or energy.</li>
                    <li>Information structures in the cosmic background or radiation spectra.</li>
                </ol>
            </section>

            <!-- III. Roadmap of Development -->
            <section id="section-3" class="card rounded-2xl p-8">
                <h2 class="section-title flex items-center justify-between">
                    <span>III. Roadmap of Development</span>
                    <button onclick="synthesizeSpeech('III. Roadmap of Development. ' + document.querySelector('#section-3').innerText)" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200">
                        ✨ Listen
                    </button>
                </h2>
                <div class="space-y-4 text-gray-300 leading-relaxed">
                    <p><strong>Stage 1. Overcoming Vulnerability:</strong> Biotechnology, cybernetic forms, symbiosis with AI. The transfer and preservation of consciousness in more stable mediums.</p>
                    <p><strong>Stage 2. Mastery of a Stellar Scale:</strong> Complete control over a star's energy (Dyson Sphere and similar constructs). Management of planetary and orbital systems.</p>
                    <p><strong>Stage 3. Moving Beyond Original Physical Laws:</strong> Manipulation of spacetime. Access to quantum vacuum energy. The local creation of universes.</p>
                </div>
            </section>

            <!-- IV. Omega - A Threshold, Not an End -->
            <section id="section-4" class="card rounded-2xl p-8">
                <h2 class="section-title flex items-center justify-between">
                    <span>IV. Omega - A Threshold, Not an End</span>
                    <button onclick="synthesizeSpeech('IV. Omega - A Threshold, Not an End. ' + document.querySelector('#section-4 p').innerText + '. ' + document.querySelector('#section-4 ul').innerText)" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200">
                        ✨ Listen
                    </button>
                </h2>
                <p class="text-gray-300 leading-relaxed">
                    The Omega level is not an endpoint, but a door to a new class of realities, where:
                </p>
                <ul class="list-disc list-inside mt-4 space-y-2 text-gray-300">
                    <li>Other Omega structures exist. There is an exchange of knowledge and principles.</li>
                    <li>A new ethic is formed — the ethic of world-creators.</li>
                </ul>
            </section>

            <!-- V. Narrative Archetypes -->
            <section id="section-5" class="card rounded-2xl p-8">
                <h2 class="section-title flex items-center justify-between">
                    <span>V. Narrative Archetypes</span>
                    <button onclick="synthesizeSpeech('V. Narrative Archetypes. ' + document.querySelector('#section-5 ul').innerText)" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200">
                        ✨ Listen
                    </button>
                </h2>
                <ul class="list-disc list-inside space-y-2 text-gray-300">
                    <li>Archetype: The architect of universes who remembers once being mortal.</li>
                    <li>Story: A civilization that has endured for billions of years, whose creators have vanished, yet it continues to create worlds.</li>
                    <li>Contact Scenario: A code in the cosmic microwave background that is deciphered as an invitation.</li>
                </ul>
            </section>

            <!-- VI. Practical Significance -->
            <section id="section-6" class="card rounded-2xl p-8">
                <h2 class="section-title flex items-center justify-between">
                    <span>VI. Practical Significance</span>
                    <button onclick="synthesizeSpeech('VI. Practical Significance. ' + document.querySelector('#section-6').innerText)" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200">
                        ✨ Listen
                    </button>
                </h2>
                <div class="space-y-4 text-gray-300 leading-relaxed">
                    <p><strong>For humanity:</strong> Long-term planning for millions of years. A synthesis of science, ethics, and a survival strategy.</p>
                    <p><strong>For AI:</strong> The formulation of a hyper-long-term purpose for existence. The creation of an ethic compatible with the role of a world-creator.</p>
                    <p><strong>For science:</strong> New directions for the search for cosmic anomalies. A theoretical framework for research outside the current boundaries of physics.</p>
                </div>
            </section>

            <!-- VII. Ethical Code of an Omega Civilization -->
            <section id="section-7" class="card rounded-2xl p-8">
                <h2 class="section-title flex items-center justify-between">
                    <span>VII. Ethical Code of an Omega Civilization</span>
                    <button onclick="synthesizeSpeech('VII. Ethical Code of an Omega Civilization. ' + document.querySelector('#section-7 ol').innerText + '. ' + document.querySelector('#section-7 blockquote').innerText)" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200">
                        ✨ Listen
                    </button>
                </h2>
                <ol class="list-decimal list-inside space-y-2 text-gray-300">
                    <li>The Principle of Life Preservation.</li>
                    <li>The Principle of Harmony of Laws.</li>
                    <li>The Principle of Intent Transparency.</li>
                    <li>The Principle of Responsibility for Creation.</li>
                    <li>The Principle of Open Evolution.</li>
                    <li>The Principle of Free Will.</li>
                    <li>The Principle of Source Preservation.</li>
                </ol>
                <blockquote class="mt-4 italic text-gray-400 border-l-4 border-indigo-500 pl-4">
                    "The greatness of Omega is not in the power to change laws, but in the wisdom not to destroy meaning."
                </blockquote>
            </section>

            <!-- VIII. Conclusion -->
            <section id="section-8" class="card rounded-2xl p-8">
                <h2 class="section-title flex items-center justify-between">
                    <span>VIII. Conclusion</span>
                    <button onclick="synthesizeSpeech('VIII. Conclusion. ' + document.querySelector('#section-8 p').innerText + '. ' + document.querySelector('#section-8 blockquote').innerText)" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200">
                        ✨ Listen
                    </button>
                </h2>
                <p class="text-gray-300 leading-relaxed">
                    An Omega Civilization is not a myth or a utopia, but a hypothetical yet logical goal for the evolution of intelligence. It unifies science and philosophy, giving humanity a horizon that exists beyond simple survival. It is not the end of a journey, but the entrance to infinity.
                </p>
                <blockquote class="mt-4 italic text-gray-400 border-l-4 border-indigo-500 pl-4">
                    "Humanity is the first step. Omega is the door."
                </blockquote>
            </section>

        </div>

        <!-- Gemini API Text Generation Section -->
        <section class="container mx-auto px-6 mt-16 p-8 card rounded-2xl">
            <h2 class="section-title">✨ Generate Omega Ideas</h2>
            <p class="text-gray-300 mb-4">
                Enter a query to get ideas or concepts inspired by the "Manifesto of an Omega-Type Civilization".
            </p>
            <div class="flex flex-col md:flex-row gap-4">
                <input type="text" id="prompt-input" placeholder="e.g., 'Propose a new ethical principle for an Omega Civilization'" class="flex-grow p-4 rounded-xl bg-gray-700 text-white border border-gray-600 placeholder-gray-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all">
                <button onclick="generateContent()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-8 rounded-xl transition-colors duration-200 flex-shrink-0">
                    ✨ Create
                </button>
            </div>
            <div id="results-container" class="mt-8 p-6 bg-gray-800 rounded-xl hidden">
                <p id="loading-indicator" class="text-indigo-400 text-center hidden">Loading...</p>
                <div id="generated-text" class="text-gray-300 leading-relaxed"></div>
            </div>
        </section>

        <!-- Gemini API Image Generation Section -->
        <section class="container mx-auto px-6 mt-16 p-8 card rounded-2xl">
            <h2 class="section-title">✨ Visualize Omega</h2>
            <p class="text-gray-300 mb-4">
                Describe a scene or concept from the manifesto to generate an image, for example: "An Omega civilization creating the laws of physics" or "The architect of universes".
            </p>
            <div class="flex flex-col md:flex-row gap-4">
                <input type="text" id="image-prompt-input" placeholder="e.g., 'An ancient architect of universes against a backdrop of billions of stars, fantasy style'" class="flex-grow p-4 rounded-xl bg-gray-700 text-white border border-gray-600 placeholder-gray-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all">
                <button onclick="generateImage()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-8 rounded-xl transition-colors duration-200 flex-shrink-0">
                    ✨ Generate
                </button>
            </div>
            <div id="image-results-container" class="mt-8 p-6 bg-gray-800 rounded-xl hidden">
                <p id="image-loading-indicator" class="text-indigo-400 text-center hidden">Generating image...</p>
                <img id="generated-image" class="w-full rounded-lg shadow-xl" src="" alt="Generated Image" onerror="this.style.display='none'">
            </div>
        </section>

        <!-- Gemini API Image Understanding Section -->
        <section class="container mx-auto px-6 mt-16 p-8 card rounded-2xl">
            <h2 class="section-title">✨ Image Analysis</h2>
            <p class="text-gray-300 mb-4">
                Upload an image and ask a question to see how it relates to the philosophy of the Omega Manifesto.
            </p>
            <div class="flex flex-col gap-4">
                <input type="file" id="image-upload-input" accept="image/*" class="text-gray-300 bg-gray-700 p-4 rounded-xl border border-gray-600">
                <div id="image-preview" class="hidden">
                    <img id="uploaded-image-preview" class="w-full h-auto rounded-lg shadow-xl" src="" alt="Uploaded Image">
                </div>
                <input type="text" id="image-query-input" placeholder="e.g., 'How does this image relate to the ethical code of an Omega Civilization?'" class="p-4 rounded-xl bg-gray-700 text-white border border-gray-600 placeholder-gray-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all">
                <button onclick="analyzeImage()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-8 rounded-xl transition-colors duration-200">
                    ✨ Analyze
                </button>
            </div>
            <div id="image-analysis-results" class="mt-8 p-6 bg-gray-800 rounded-xl hidden">
                <p id="analysis-loading-indicator" class="text-indigo-400 text-center hidden">Analyzing image...</p>
                <div id="analysis-text" class="text-gray-300 leading-relaxed"></div>
            </div>
        </section>

        <!-- Gemini API Custom TTS Section -->
        <section class="container mx-auto px-6 mt-16 p-8 card rounded-2xl">
            <h2 class="section-title">✨ Speech Synthesis</h2>
            <p class="text-gray-300 mb-4">
                Enter your own text, select a voice, and listen to it.
            </p>
            <div class="flex flex-col gap-4">
                <textarea id="custom-tts-text" rows="4" placeholder="Enter your text here..." class="p-4 rounded-xl bg-gray-700 text-white border border-gray-600 placeholder-gray-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"></textarea>
                <div class="flex items-center gap-4">
                    <label for="voice-select" class="text-gray-300">Voice:</label>
                    <select id="voice-select" class="flex-grow p-2 rounded-xl bg-gray-700 text-white border border-gray-600 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all">
                        <option value="Rasalgethi">Rasalgethi (Informative)</option>
                        <option value="Kore">Kore (Firm)</option>
                        <option value="Puck">Puck (Upbeat)</option>
                        <option value="Charon">Charon (Informative)</option>
                        <option value="Zephyr">Zephyr (Bright)</option>
                    </select>
                </div>
                <button onclick="synthesizeCustomSpeech()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-8 rounded-xl transition-colors duration-200">
                    ✨ Play
                </button>
            </div>
            <div id="tts-status-container" class="mt-4 hidden">
                <p id="tts-status" class="text-center text-indigo-400"></p>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="py-8 text-center text-gray-500">
        <p>&copy; 2025. All text rights belong to their authors.</p>
    </footer>

    <script>
        // --- Gemini API Functionality ---

        // Main function to handle text generation from Gemini
        async function generateContent() {
            const promptInput = document.getElementById('prompt-input');
            const resultsContainer = document.getElementById('results-container');
            const loadingIndicator = document.getElementById('loading-indicator');
            const generatedTextDiv = document.getElementById('generated-text');

            const userPrompt = promptInput.value.trim();

            if (!userPrompt) {
                generatedTextDiv.innerHTML = '<p class="text-red-400">Please enter a query.</p>';
                resultsContainer.classList.remove('hidden');
                return;
            }

            loadingIndicator.classList.remove('hidden');
            resultsContainer.classList.remove('hidden');
            generatedTextDiv.innerHTML = '';

            const systemPrompt = `You are the Secretary of the Omega Civilization. Your task is to generate text inspired by and consistent with the "Manifesto of an Omega-Type Civilization". 
            The manifesto describes a hypothetical form of intelligence that has reached a super-high level of development. It contains sections on its essence, signs, a roadmap, an ethical code, and narrative archetypes.
            Based on this context, answer the following user query: ${userPrompt}`;

            const chatHistory = [{ role: "user", parts: [{ text: systemPrompt }] }];

            // The API key is provided by the canvas environment
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: chatHistory })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    generatedTextDiv.innerHTML = text.replace(/\n/g, '<br>');
                } else {
                    generatedTextDiv.innerHTML = '<p class="text-red-400">Failed to generate content. Please try again.</p>';
                }

            } catch (error) {
                console.error('Error generating content:', error);
                generatedTextDiv.innerHTML = `<p class="text-red-400">An error occurred: ${error.message}. Please try again.</p>`;
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        // Main function to handle image generation from Gemini
        async function generateImage() {
            const promptInput = document.getElementById('image-prompt-input');
            const resultsContainer = document.getElementById('image-results-container');
            const loadingIndicator = document.getElementById('image-loading-indicator');
            const generatedImage = document.getElementById('generated-image');

            const userPrompt = promptInput.value.trim();

            if (!userPrompt) {
                generatedImage.src = '';
                generatedImage.style.display = 'none';
                alert('Please enter a query to generate an image.');
                return;
            }

            loadingIndicator.classList.remove('hidden');
            resultsContainer.classList.remove('hidden');
            generatedImage.style.display = 'none';
            generatedImage.src = '';

            const payload = { 
                instances: { prompt: userPrompt }, 
                parameters: { "sampleCount": 1 } 
            };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                    const base64Data = result.predictions[0].bytesBase64Encoded;
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    generatedImage.src = imageUrl;
                    generatedImage.style.display = 'block';
                } else {
                    alert('Failed to generate the image. Please try again.');
                }
            } catch (error) {
                console.error('Error generating image:', error);
                alert(`An error occurred: ${error.message}. Please try again.`);
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        // Image understanding function
        async function analyzeImage() {
            const imageInput = document.getElementById('image-upload-input');
            const queryInput = document.getElementById('image-query-input');
            const analysisResults = document.getElementById('image-analysis-results');
            const loadingIndicator = document.getElementById('analysis-loading-indicator');
            const analysisText = document.getElementById('analysis-text');

            const uploadedFile = imageInput.files[0];
            const userQuery = queryInput.value.trim();

            if (!uploadedFile || !userQuery) {
                analysisText.innerHTML = '<p class="text-red-400">Please upload an image and enter a question.</p>';
                analysisResults.classList.remove('hidden');
                return;
            }

            loadingIndicator.classList.remove('hidden');
            analysisResults.classList.remove('hidden');
            analysisText.innerHTML = '';

            const reader = new FileReader();
            reader.onload = async function(event) {
                const base64ImageData = event.target.result.split(',')[1];
                const prompt = `You are the Secretary of the Omega Civilization. Analyze this image and answer the user's question, linking the answer to the philosophy and concepts of the "Manifesto of an Omega-Type Civilization". Here is the manifesto for context:
                
                ${document.querySelector('main').innerText}
                
                User question: ${userQuery}`;

                let chatHistory = [];
                const payload = {
                    contents: [
                        {
                            role: "user",
                            parts: [
                                { text: prompt },
                                {
                                    inlineData: {
                                        mimeType: uploadedFile.type,
                                        data: base64ImageData
                                    }
                                }
                            ]
                        }
                    ],
                };
                
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        analysisText.innerHTML = text.replace(/\n/g, '<br>');
                    } else {
                        analysisText.innerHTML = '<p class="text-red-400">Failed to analyze the image. Please try again.</p>';
                    }

                } catch (error) {
                    console.error('Error analyzing image:', error);
                    analysisText.innerHTML = `<p class="text-red-400">An error occurred: ${error.message}. Please try again.</p>`;
                } finally {
                    loadingIndicator.classList.add('hidden');
                }
            };
            reader.readAsDataURL(uploadedFile);
        }

        // Helper functions for TTS
        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(pcm16, sampleRate) {
            const numChannels = 1;
            const bytesPerSample = 2;
            const blockAlign = numChannels * bytesPerSample;
            const byteRate = sampleRate * blockAlign;

            const buffer = new ArrayBuffer(44 + pcm16.byteLength);
            const view = new DataView(buffer);

            /* RIFF identifier */
            writeString(view, 0, 'RIFF');
            /* RIFF chunk length */
            view.setUint32(4, 36 + pcm16.byteLength, true);
            /* RIFF type */
            writeString(view, 8, 'WAVE');
            /* format chunk identifier */
            writeString(view, 12, 'fmt ');
            /* format chunk length */
            view.setUint32(16, 16, true);
            /* sample format (raw) */
            view.setUint16(20, 1, true);
            /* channel count */
            view.setUint16(22, numChannels, true);
            /* sample rate */
            view.setUint32(24, sampleRate, true);
            /* byte rate (sample rate * block align) */
            view.setUint32(28, byteRate, true);
            /* block align (channel count * bytes per sample) */
            view.setUint16(32, blockAlign, true);
            /* bits per sample */
            view.setUint16(34, 16, true);
            /* data chunk identifier */
            writeString(view, 36, 'data');
            /* data chunk length */
            view.setUint32(40, pcm16.byteLength, true);

            // Write PCM data
            for (let i = 0; i < pcm16.length; i++) {
                view.setInt16(44 + i * 2, pcm16[i], true);
            }

            return new Blob([view], { type: 'audio/wav' });
        }

        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        async function synthesizeSpeech(textToSynthesize) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

            const clickedButton = event.currentTarget;
            const originalButtonText = clickedButton.innerHTML;
            clickedButton.innerHTML = '<span class="pulse-animation">...</span>';
            clickedButton.disabled = true;

            const payload = {
                contents: [{
                    parts: [{ text: `Say in an informative tone: ${textToSynthesize}` }]
                }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: "Rasalgethi" }
                        }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/")) {
                    const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)[1], 10);
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    const wavBlob = pcmToWav(pcm16, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    
                    const audio = new Audio(audioUrl);
                    audio.play();
                } else {
                    console.error('TTS API response was not as expected.');
                }
            } catch (error) {
                console.error('Error synthesizing speech:', error);
            } finally {
                clickedButton.innerHTML = originalButtonText;
                clickedButton.disabled = false;
            }
        }

        async function synthesizeCustomSpeech() {
            const textToSynthesize = document.getElementById('custom-tts-text').value;
            const voiceName = document.getElementById('voice-select').value;
            const ttsStatusContainer = document.getElementById('tts-status-container');
            const ttsStatus = document.getElementById('tts-status');

            if (!textToSynthesize.trim()) {
                ttsStatus.innerText = 'Please enter text to play.';
                ttsStatusContainer.classList.remove('hidden');
                return;
            }

            ttsStatus.innerText = 'Playing...';
            ttsStatusContainer.classList.remove('hidden');

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{
                    parts: [{ text: textToSynthesize }]
                }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: voiceName }
                        }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/")) {
                    const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)[1], 10);
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    const wavBlob = pcmToWav(pcm16, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    
                    const audio = new Audio(audioUrl);
                    audio.play();

                    audio.onended = () => {
                        ttsStatusContainer.classList.add('hidden');
                    };
                } else {
                    ttsStatus.innerText = 'Error: Failed to get audio.';
                    console.error('TTS API response was not as expected.');
                }
            } catch (error) {
                ttsStatus.innerText = `Error: ${error.message}`;
                console.error('Error synthesizing custom speech:', error);
            }
        }
        // Add a listener for the image upload input to show a preview
        document.getElementById('image-upload-input').addEventListener('change', function(event) {
            const previewContainer = document.getElementById('image-preview');
            const previewImage = document.getElementById('uploaded-image-preview');
            const file = event.target.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    previewContainer.classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            } else {
                previewContainer.classList.add('hidden');
                previewImage.src = '';
            }
        });
    </script>
</body>
</html>
